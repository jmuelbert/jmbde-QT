name: Apply clang-tidy fixes
on:
    push:
        branches:
            - "**"
jobs:
    check:
        runs-on: ubuntu-20.04
        steps:
            - uses: actions/checkout@v2
            - name: Setup
              run: |
                  sudo apt-get install -y clang-tidy libboost-dev
            - name: Check
              run: |
                  find . -name *.[hc]pp -not -name config.*.hpp -not -name all.hpp -not -name quantlib.hpp -not -name paralleltestrunner.hpp | sort | xargs -n 1 clang-tidy -quiet -fix $1 -- -std=c++03 -I$PWD
            - uses: peter-evans/create-pull-request@v2
              with:
                  token: ${{ secrets.GITHUB_TOKEN }}
                  branch: clang-tidy-fixes-${{ github.ref }}
                  commit-message: "Automated fixes by clang-tidy"
                  title: "Automated fixes by clang-tidy"
                  body: |
                      This is an automated PR generated by the [create-pull-request](https://github.com/peter-evans/create-pull-request) GitHub action.
                      Please review the changes before merging.
